<!DOCTYPE html>
<html lang="en" data-theme="light">
<head>
  <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Skill Pro</title>

    <link rel="stylesheet" href="Styles/styles.css">
    <link rel="stylesheet" href="Styles/Nav.css" />
    <link rel="stylesheet" href="Styles/allCourses.css">

    <!-- tailwind and daisy UI -->

    <link
      href="https://cdn.jsdelivr.net/npm/daisyui@4.12.13/dist/full.min.css"
      rel="stylesheet"
      type="text/css"
    />
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- font awesome cdn -->

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css" integrity="sha512-Kc323vGBEqzTmouAECnVceyQqyqdsSiqLQISBL29aUW4U/M7pSPA/gEUZQqv1cwx4OnYxTxve5UMg5GT6L4JJg==" crossorigin="anonymous" referrerpolicy="no-referrer" />

    <!-- tailwind custom color -->
    <script>
      tailwind.config = {
        theme: {
          extend: {
            colors: {
              clifford: "#da373d",
            },
          },
        },
      };
    </script>
</head>
<body>
 

  <h2 class="text-center text-4xl text-white bg-[#283747] p-5 font-extrabold" >All Students</h2>

  

  

 <div class="instructor-requat">
  <?php
include("database.php");

// Fetch pending instructor requests
$sql = "SELECT user_id, firstName, lastName, profile_pic, email, bio, phone, address FROM User WHERE role = 'instructor_pending'";
$result = $conn->query($sql);
?>

<div class="flex flex-wrap justify-center gap-4">
    <?php if ($result->num_rows > 0): ?>
        <?php while ($row = $result->fetch_assoc()): ?>
            <div class="w-full sm:w-1/2 lg:w-1/3 p-2"> <!-- Each card takes up 1/3 of the width on large screens -->
                <div class="bg-white shadow-xl rounded-lg py-3">
                    <div class="photo-wrapper p-2">
                        <img class="w-32 h-32 rounded-full mx-auto" src="<?= htmlspecialchars($row['profile_pic'] ?: 'default-profile.png'); ?>" alt="Profile">
                    </div>
                    <div class="p-2">
                        <h3 class="text-center text-xl text-gray-900 font-medium leading-8"><?= htmlspecialchars($row['firstName'] . ' ' . $row['lastName']); ?></h3>
                        <div class="text-center text-gray-400 text-xs font-semibold">
                            <p>Pending Instructor</p>
                        </div>
                        <table class="text-xs my-3">
                            <tbody>
                                <tr><td class="px-2 py-2 text-gray-500 font-semibold">Address</td><td class="px-2 py-2"><?= htmlspecialchars($row['address']); ?></td></tr>
                                <tr><td class="px-2 py-2 text-gray-500 font-semibold">Phone</td><td class="px-2 py-2"><?= htmlspecialchars($row['phone']); ?></td></tr>
                                <tr><td class="px-2 py-2 text-gray-500 font-semibold">Email</td><td class="px-2 py-2"><?= htmlspecialchars($row['email']); ?></td></tr>
                                <tr><td class="px-2 py-2 text-gray-500 font-semibold">Bio</td><td class="px-2 py-2"><?= htmlspecialchars($row['bio']); ?></td></tr>
                            </tbody>
                        </table>

                        <div class="text-center my-3">
                            <form method="post" action="approve_request.php">
                                <input type="hidden" name="user_id" value="<?= $row['user_id']; ?>">
                                <input type="hidden" name="bio" value="<?= htmlspecialchars($row['bio']); ?>">
                                <button type="submit" name="confirm" class="btn btn-outline btn-success">Confirm</button>
                                <button type="submit" name="reject" class="btn btn-outline btn-error">Reject</button>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        <?php endwhile; ?>
    <?php else: ?>
        <p>No pending instructor requests.</p>
    <?php endif; ?>
</div>

<?php
// Handle confirmation or rejection
if ($_SERVER["REQUEST_METHOD"] === "POST") {
    $user_id = $_POST['user_id'];

    if (isset($_POST['confirm'])) {
        $expertise = $_POST['bio'];

        // Insert into Instructor table
        $stmt = $conn->prepare("INSERT INTO Instructor (user_id, expertise) VALUES (?, ?)");
        $stmt->bind_param("is", $user_id, $expertise);
        $stmt->execute();

        // Update User role
        $conn->query("UPDATE User SET role = 'instructor' WHERE user_id = $user_id");
    } elseif (isset($_POST['reject'])) {
        // Optionally handle rejections (e.g., delete user or notify them)
        $conn->query("DELETE FROM User WHERE user_id = $user_id");
    }

    header("Location: approve_request.php");
    exit();
}

$conn->close();
?>

 </div>
  
</body>
</html>